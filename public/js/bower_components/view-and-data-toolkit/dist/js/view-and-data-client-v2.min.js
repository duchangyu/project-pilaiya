var Autodesk=Autodesk||{};Autodesk.ADN=Autodesk.ADN||{},Autodesk.ADN.Toolkit=Autodesk.ADN.Toolkit||{},Autodesk.ADN.Toolkit.ViewAndData=Autodesk.ADN.Toolkit.ViewAndData||{},Autodesk.ADN.Toolkit.ViewAndData.Client=function(e,t){function s(e){switch(e){case 200:return"Success";case 400:return"The request could not be understood by the server due to malformed syntax or missing request headers. The client SHOULD NOT repeat the request without modification.";case 401:return"The supplied authorization header was not valid or the supplied token scope was not acceptable. Verify authentication and try again.";case 403:return"The authorization was successfully validated but permission is not granted.  Do not try again unless you resolve permissions first.";case 404:return"Object does not exist.";case 409:return"Object already exists.";case 423:return"Server is busy.  Please retry after some time.";case 500:return"Internal failure while processing the request, reason depends on error.";default:return"Unknown error."}}function n(e,t){try{var n=new XMLHttpRequest;n.open("GET",a,!0),n.onreadystatechange=function(){if(4==n.readyState)if(200==n.status)try{var a=JSON.parse(n.responseText);e&&e(a)}catch(o){r=""}else t&&t({status:n.status,description:s(n.status),response:n.responseText})},n.send(null)}catch(o){t&&t(o)}}var a=t,r=null,o=null,i=e;n(function(e){var t=arguments.callee;setTimeout(function(){n(t)},1e3*e.expires_in),r=e,o&&(o(),o=null)},function(e){console.log("ViewAndDataClient error requesting token: "+e)}),this.onInitialized=function(e){r?e():o=e},this.setToken=function(){var e={oauth2:{token:r.access_token}},t=new XMLHttpRequest;t.open("POST",i+"/derivativeservice/v2/token",!1),t.setRequestHeader("Content-Type","application/json"),t.withCredentials=!0,t.send(JSON.stringify(e))},this.createBucket=function(e,t,n){try{var a=new XMLHttpRequest;a.open("POST",i+"/oss/v2/buckets",!0),a.setRequestHeader("Authorization","Bearer "+r.access_token),a.setRequestHeader("Content-Type","application/json"),a.onreadystatechange=function(){4==a.readyState&&(200==a.status?t&&t(JSON.parse(a.responseText)):n&&n({status:a.status,description:s(a.status),response:JSON.parse(a.responseText)}))},a.send(JSON.stringify(e))}catch(o){n&&n(o)}},this.getBucketDetails=function(e,t,n){try{var a=new XMLHttpRequest;a.open("GET",i+"/oss/v2/buckets/"+e+"/details",!0),a.setRequestHeader("Authorization","Bearer "+r.access_token),a.setRequestHeader("Content-Type","application/json"),a.onreadystatechange=function(){4==a.readyState&&(200==a.status?t&&t(JSON.parse(a.responseText)):n&&n({status:a.status,description:s(a.status),response:JSON.parse(a.responseText)}))},a.send()}catch(o){n&&n(o)}},this.uploadFile=function(e,t,s,n,a){var o=new XMLHttpRequest;o.open("PUT",i+"/oss/v2/buckets/"+t+"/objects/"+s,!0),o.setRequestHeader("Authorization","Bearer "+r.access_token),o.setRequestHeader("Content-Type","application/stream"),o.onload=function(){var t=JSON.parse(o.responseText);t.file=e,n&&n(t)};var u=new FileReader;u.onerror=a,u.onabort=a,u.onloadend=function(e){if(e.target.readyState==FileReader.DONE)try{o.send(e.target.result)}catch(t){a&&a(t)}else a&&a(e)};var c=e.slice(0,e.size);u.readAsArrayBuffer(c)},this.register=function(e,t,n,a){try{var o=new XMLHttpRequest;o.open("POST",i+"/derivativeservice/v2/registration",!0),o.setRequestHeader("Authorization","Bearer "+r.access_token),o.setRequestHeader("Content-Type","application/json"),a&&o.setRequestHeader("x-ads-force","true");var u={design:this.toBase64(e)};o.onreadystatechange=function(){4==o.readyState&&(200==o.status||201==o.status?t&&t(JSON.parse(o.responseText)):n&&n({status:o.status,description:s(o.status),response:JSON.parse(o.responseText)}))},o.send(JSON.stringify(u))}catch(c){n&&n(c)}},this.getThumbnail=function(e,t,n,a,o,u){try{var c=new XMLHttpRequest;c.open("GET",i+"/derivativeservice/v2/thumbnails/"+this.toBase64(e),!0),c.setRequestHeader("Authorization","Bearer "+r.access_token),c.responseType="arraybuffer",c.onload=function(){if(200==this.status){var e=btoa(String.fromCharCode.apply(null,new Uint8Array(this.response)));t&&t(e)}else n&&n({status:c.status,description:s(c.status),response:""})},c.send()}catch(d){n&&n(d)}},this.getViewable=function(e,t,n,a,o){try{var u=o?"?guid="+o:"",c="";switch(a){case"status":c="/status";break;case"all":c="/all"}var d=new XMLHttpRequest;d.open("GET",i+"/derivativeservice/v2/manifest/"+this.toBase64(e)+c+u,!0),d.setRequestHeader("Authorization","Bearer "+r.access_token),d.onreadystatechange=function(){4==d.readyState&&(200==d.status?t&&t(JSON.parse(d.responseText)):n&&n({status:d.status,description:s(d.status),response:JSON.parse(d.responseText)}))},d.send()}catch(p){n&&n(p)}},this.getSubItemsWithProperties=function(e,t,s,n){function a(e,t){var s=!0;for(var n in t){if(!e.hasOwnProperty(n)){s=!1;break}if(e[n]!==t[n]){s=!1;break}}return s}function r(e,t){var s=[];if(a(e,t)&&s.push(e),"undefined"!=typeof e.children)for(var n=0;n<e.children.length;++n){var o=r(e.children[n],t);s=s.concat(o)}return s}this.getViewable(e,function(e){var n=r(e,t);s&&s(n)},n,"all")},this.toBase64=function(e){return window.btoa(unescape(encodeURIComponent(e)))},this.fromBase64=function(e){return decodeURIComponent(escape(window.atob(e)))}};